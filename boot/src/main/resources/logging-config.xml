<?xml version="1.0" encoding="UTF-8"?>

<!--<configuration scan="true" scanPeriod="60 seconds" debug="false">-->
<!--    <property name="context-name" value="app"/>-->
<!--    <contextName>${context-name}</contextName>-->

<!--    <appender>-->
<!--    </appender>-->

<!--    <logger>-->
<!--    </logger>-->

<!--    <root>-->
<!--    </root>-->
<!--</configuration>-->


<configuration scan="true" scanPeriod="60 seconds" debug="false">
    <!--  配置链路追踪的 trackId  -->
    <contextListener class="com.ofpay.logback.TtlMdcListener"/>

    <property name="CONSOLE_LOG_PATTERN"
              value="${CONSOLE_LOG_PATTERN:-%clr(%d{ISO8601}){faint} %clr(${LOG_LEVEL_PATTERN:-%5p}) %clr([%15.15t]){faint} [%clr(%19X{trackId})] %clr(%-40.40logger{39}){cyan} [%line]%clr(:){faint} %m%n${LOG_EXCEPTION_CONVERSION_WORD:-%wEx}}"/>
    <property name="FILE_LOG_PATTERN"
              value="${FILE_LOG_PATTERN:-%d{ISO8601}} ${LOG_LEVEL_PATTERN:-%5p} [%t] [%clr(%19X{trackId})] %-40.40logger{39} [%line]: %m%n${LOG_EXCEPTION_CONVERSION_WORD:-%wEx}}"/>
    <include resource="org/springframework/boot/logging/logback/base.xml"/>


    <appender name="ASYNC_FILE" class="ch.qos.logback.classic.AsyncAppender">
        <!-- 不丢失日志.默认的,如果队列的80%已满,则会丢弃TRACT、DEBUG、INFO级别的日志 -->
        <discardingThreshold>0</discardingThreshold>
        <!-- 更改默认的队列的深度,该值会影响性能.默认值为256 -->
        <queueSize>2048</queueSize>
        <includeCallerData>true</includeCallerData>
        <!-- 添加附加的appender,最多只能添加一个 -->
        <appender-ref ref="FILE"/>
    </appender>

    <!--    <logger name="com.xiaolyuh" level="debug" additivity="true"/>-->
</configuration>

